---
layout: post
title: 局域网以太网
date: 2022-10-25 18:23 +0800
---
以太网技术是局域网(LAN)的常用技术. 

## 以太网版本
### Ethernet V2
1975年由美国施乐公司(Xerox)研制成功, 1982年修改为第二版,即Ethernet V2
### IEEE802.2/802.3
1983年IEEE802委员会的802.3工作组制定了第一个IEEE的的以太网标准IEEE802.3,数据率为10Mb/s.

802.3局域网对以太网标准中的帧格式做了很小的一点更动,但允许基于这两种标准的硬件实现可以在同一个局域网上互操作.

## 以太网的发展
以太网的发展: 标准以太网(Ethernet)10Mbps -> 快速以太网(FastEthernet)100Mpbs -> 吉比特以太网(GigabitEthernet)1Gbps -> 10G以太网(ten-GigabitEthernet) -> ...

## 以太网协议栈

以太网物理层标准: 802.3 10Base-5, 802.3a 10Base-2, 802.3i 10Base-T, 802.3u 100Base-Tx, 802.3u 100Base-Fx, 802.3ab 1000Base-T, 802.3z 1000Base-X, 802.3ae 10GBase-LR/LW, 802.3ae 10GBase-ER/EW .

数据链路层:
- LLC子层: 逻辑链路控制(LLC) 定义如何在数据链路层内多路复用网络层协议
- MAC子层: 媒体介入控制层(MAC) 定义信息是如何在以太网环境中传递的,并且定义成帧, Mac寻址以及关于以太网如何工作的技术细节.

### 以太网帧结构
Ethernet II

|6字节|6字节|2字节|46-1500字节|4字节|
|---|---|---|---|---|
|DMAC|SMAC|Type|Data|CRC|

802.3

|6字节|6字节|2字节|46-1500字节|4字节|
|---|---|---|-------|---|
|DMAC|SMAC|Length|LLC\Data|CRC|

LLC

|1字节|1字节|1字节|
|----|----|----|
|DSAP|SSAP|CONTRIL|

- DMAC: 目标 MAC
- SMAC: 源 MAC
- Type: 类型字段, 复用网络层,指明网络上层是什么协议
- LLC: 做网络层协议的一个复用, 是802.3的类型字段
- CRC: 哈希校验码

## 以太网协议工作原理
以太网访问特征
- 共享介质信道,公平的保障信道上的工作站均能控制信道发送数据.
- 公平竞争性介质访问方法.

介入到信道的PC发送数据,信道上的所有PC都能收到.

CSMA/CD
- 载波侦听多路访问/冲突检测
  - 多路访问
    - 网络上所有工作站共享数据信道, 并且以广播方式发送.
  - 载波侦听
    - 发送数据前侦听总线上是否有数据传输
    - 若无数据传输,立即发送准备好的数据
    - 若有数据传输,则不发送数据
  - 冲突检测
    - 发送数据过程中还要不停地检测自己发送的数据,有没有在传输过程中与其他工作站的数据发生冲突
    - 退避算法: 随即延迟值

## 共享式以太网工作原理
- 总线型以太网组网
  - 工作机制: CSMA/CD
  - 总线结构: 采用同轴电缆传输介质
  - 物理标准: 10base-2/10base-5等
  - 优点
    - 部署简单,设备要求不高
    - 所需线缆少,价格便宜
  - 缺点
    - 不易隔离故障点
    - 易造成网络拥塞
- 星型以太网结构
  - 采用专用的网络设备如集线器(HUB)作为核心节点
  - 采用双绞线传输介质
  - 逻辑上仍然为总线结构
  - 优点
    - 管理方便, 容易扩展
  - 缺点
    - 与物理总线型一样,网络传输效率低
    - 安全性差

## 交换式以太网工作原理
交换机的应用
- 硬件结构
  - 交换矩阵: 多路并行处理
- 软件算法
  - 交换机学习功能
    - 通过动态学习或静态绑定构建MAC地址表
  - 交换机转发功能
    - 通过查找MAC地址表决定数据帧往哪个端口发送

交换机MAC表学习功能: MAC地址表存放两个条目,一个是MAC地址,一个是Port端口. PC1 访问PC2发送数据帧,交换机从端口1接收到数据帧提取数据侦源MAC,将该MAC地址与接收端口写入MAC地址表, 对于已经存在的MAC地址条目再次收到数据帧时更新老化时间. MAC表的学习是动态的,默认老化时间是300s,过了老化时间就会更新条目,在老化时间里收到PC就会重新更新老化时间.

交换机转发功能: 
- 已知单播帧: PC2访问PC1,发送数据帧,交换机提取数据帧目录目标MAC地址查找MAC此址表,MAC条目已存在,从条目中绑定的端口转发出去.
- 未知单播帧: PC2访问PC3,发送数据侦,交换机没有学到PC3MAC地址,交换机查找不到MAC地址对应的端口,从其他所有端口泛洪出去.
- 广播帧: PC2发送一个广播帧给所有PC,MAC地址为:FFFF.FFFF.FF贷款FF,交换机接收后从除接收端口的其余所有端口中发送出去.

交换机过滤功能: 从接口上收到的数据帧不会再从该接口上发送回去.

## 冲突域与广播域
- 冲突域
  - 信号在介质上传输时会产生冲突的区域
  - 共享信道的环境都是在同一个冲突域
- 集线器与交换机冲突域
  - 集线器所有端口在同一冲突域,共享网络带宽
  - 交换机的每一个端口在一个冲突域,独享端口带宽

- 广播域
  - 广播报文能否到达的区域
- 设备的广播域
  - 集线器所有端口都在同一广播域
  - 交换机默认情况下共享同一广播域
  - 路由器的每一个端口是一个广播域

## 以太网双工模式
- 半双工以太网(half-duplex)
  - 只使用了一对电缆线,数字信号在线路上是双向传输的
  - 通信线缆的两端都能发送和接收数据,但在同一时间内只能一端发另一端收
- 同轴电缆与集线器
  - 端口都是工作在半双工模式
  - 标准以太网:半双工
- 全双工以太网(full-duplex)
  - 使用了二对电缆线,数字信号在线路上是双向传输的
  - 通信线缆的两端都能发送和接收数据,两端的收发可以同时进行.
- 其它类型以太网双工模式
  - 快速以太网:半双工/全双工
  - 吉比特以太网:全双工
  - 10G以太网:全双工
- 单工(simplex)
  - 单向信号传输,一端设备只能发送,另外一端只能接收
  - 介质的传输物理层特性,无法手动或协商修改
- 速率/双工协商
  - 以太网电接口速率双工协商
    - speed auto:速率没有协商时,从线路匹配
    - duplex auto:双工没有协商时,降为半双工
    - 两边速率不匹配:不通
    - 两边双工不匹配:丢包

## 局域网传输介质
### 双绞线
- 双绞线
  - 定义: 双绞线是由一对或者多对按照规则缠绕在一起的绝缘铜芯电线,传递电信号
  - 按照屏蔽层的有无分类
    - 屏蔽双绞线(STP)
      - 金属屏蔽层
      - 减少辐射,电磁干扰,防止信息被且听
    - 非屏蔽双绞线(UTP)(最便宜和常用)
  - 按照线径粗细分类
    - 三类线(CAT3):传输频率为16MHz,传输速率为10Mbps,主要用于10Base-T
    - 四类线(CAT4):传输频率为20MHz,传输速率为16Mbps,主要用于基于令牌的局域网和10Base-T/100Base-T.多用于令牌网的布线
    - 五类线(CAT5):传输频率为100MHz,传输速率为100Mbps,主要用于100Base-T和10Base-T网络.5类双绞线是目前网络布线的主流
    - 超五类线(CAT5e):超五类线主要用于千兆位以太网(1000Mbps)
    - 六类线(CAT6):提供2倍于超五类的带宽,适用于传输速率高于1Gbps的应用
  - 双绞线线序标准
    - 以太网电端口:RJ45
      - ![RJ45标准](/assets/img/rj45.webp)
    - T568A标准(Pin:Color, 针脚对应的线颜色)
      - 1:绿白 2:绿 3:橙白 4:蓝 5:蓝白 6:橙 7:棕白 8:棕
      - ![T568A](/assets/img/T568A.png)
    - T568B标准
      - 1:橙白 2:橙 3:绿白 4:蓝 5:蓝白 6:绿 7:棕白 8 棕 
      - ![T568B](/assets/img/T568B.png)
  - 双绞线的每根铜线的作用
    - 1,2用于发送, 3,6用于接受, 4,5用于语音, 7,8是双向线
  - 双绞线的互连
    - 直通线: 不同类型的设备间互连(相同的标准)
      - T568A <--> T568A
      - T568B <--> T568B
    - 交叉线: 相同类型的设备间互连(不同的标准)
      - T568A <--> T568B
    - 反转线: Console线的使用
      - T568A <--> 反转
      - T568B <--> 反转
    - 线序自适应交换机(智能MDI/MDIX): 可以自适应识别线序
### 光纤
- 光纤定义: 光导纤维组成传播光信号的传输介质
  - 光缆  
    - 一定数量的光纤按照一定方式组成光缆
    - GYTA/2-6, GYTA/8-12, GYTA/14-18
    - GYTA/20-24, GYTA/26-30
- 光纤类型
  - 单模光纤:中心玻璃芯粗(50或62.5um), 可传多种模式的光,传输距离远,容量大,费用贵.
  - 多模光纤:光信号是以多个模式方式进行传播的,传输距离短(不超过2KM),容量小,费用便宜.
- 设备光纤端口
  - 以太网Combo复合接口,有两种接口,可以插光口或电口,但是同时只能插一个口.
- 光纤模块
  - 光纤模块作用:光点信号转换
  - 光纤模块类型
    - SFP
      - Small Form-Factor Pluggable Interface Converter(小型封装可热插拔)
      - XFP:万兆以太网小型封装可热插拔
    - GBIC
      - Gigabit Interface Converter(千兆以太接口转换器)
      - XENPAK:万兆以太网接口收发器集合封装
- 光纤接口与光纤跳线
  - 光纤连接器
    - SC连接器, LC连接器,
    - ST连接器, FC连接器
  - 光纤跳线
    - 单模光纤跳线
    - 多模光纤跳线